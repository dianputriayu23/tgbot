# Telegram Bot для расписания колледжа

Полнофункциональный Telegram-бот для управления расписанием занятий в колледже с автоматическим парсингом XLS/XLSX файлов, уведомлениями и поддержкой 1000+ одновременных пользователей.

## Основные возможности

### 1. Парсинг расписания
- ✅ Автоматическая загрузка расписания с сайта колледжа
- ✅ Поддержка сложных XLS/XLSX файлов с объединенными ячейками
- ✅ Устойчивость к различным форматам и аномалиям в файлах
- ✅ Использует две стратегии парсинга (calamine и ручной XML)
- ✅ Автоматическая проверка обновлений каждые 30 минут

### 2. Уведомления
- ✅ Утренние напоминания о расписании (настраиваемое время, по умолчанию 07:30)
- ✅ Уведомления об изменениях в расписании
- ✅ Все уведомления можно включать/выключать индивидуально
- ✅ Настраиваемое время напоминаний

### 3. База данных
- ✅ Асинхронная работа с SQLite через aiosqlite
- ✅ Индексы для оптимизации производительности
- ✅ Поддержка 1000+ одновременных пользователей
- ✅ Хранение профилей пользователей и настроек уведомлений

### 4. Пользовательский интерфейс
- ✅ Интуитивная регистрация с выбором формы обучения, курса и группы
- ✅ Просмотр расписания на сегодня, завтра или конкретный день недели
- ✅ Настройки профиля и уведомлений
- ✅ Информация о боте и справка

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/dianputriayu23/tgbot.git
cd tgbot
```

2. Создайте виртуальное окружение и активируйте его:
```bash
python -m venv venv

# Windows
venv\Scripts\activate

# Linux/Mac
source venv/bin/activate
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Создайте файл `.env` на основе `.env.example`:
```bash
cp .env.example .env
```

5. Заполните `.env` файл:
```
API_TOKEN=ваш_токен_бота_telegram
ADMIN_ID=ваш_id_администратора
```

## Использование

Запустите бота:
```bash
python main.py
```

## Структура проекта

```
tgbot/
├── database/           # Модуль работы с базой данных
│   └── db.py          # Класс Database с методами для работы с SQLite
├── handlers/          # Обработчики команд и сообщений
│   ├── common.py      # Общие команды (старт, помощь, настройки)
│   └── schedule_viewer.py  # Просмотр расписания
├── keyboards/         # Клавиатуры для бота
│   ├── inline.py      # Инлайн-клавиатуры
│   └── reply.py       # Reply-клавиатуры
├── notifications/     # Система уведомлений
│   └── __init__.py    # NotificationService для отправки уведомлений
├── parser/            # Парсер расписания
│   └── parser.py      # Загрузка и парсинг XLSX файлов
├── scheduler/         # Планировщик задач
│   └── jobs.py        # Настройка APScheduler
├── utils/             # Утилиты
│   └── states.py      # FSM состояния для регистрации
├── .env.example       # Пример файла с переменными окружения
├── .gitignore         # Git ignore файл
├── main.py            # Точка входа в приложение
└── requirements.txt   # Зависимости проекта
```

## Основные команды бота

- `/start` - Начало работы с ботом, регистрация
- `Сегодня` - Показать расписание на сегодня
- `Завтра` - Показать расписание на завтра
- `Понедельник...Суббота` - Показать расписание на конкретный день
- `⚙️ Настройки` - Изменить группу или настройки уведомлений
- `❓ Помощь` - Справка о командах бота

## Технологии

- **Python 3.12+**
- **aiogram 3.10** - Асинхронный фреймворк для Telegram Bot API
- **aiosqlite** - Асинхронная работа с SQLite
- **APScheduler** - Планировщик задач
- **python-calamine** - Парсинг Excel файлов
- **BeautifulSoup4** - Парсинг HTML
- **aiohttp** - Асинхронные HTTP запросы

## Особенности реализации

### Парсинг XLS/XLSX файлов
Бот использует двухуровневую стратегию парсинга:
1. **Calamine** - Быстрая библиотека на Rust для парсинга Excel
2. **Ручной XML парсинг** - Запасной вариант при сбое первой стратегии

Парсер устойчив к:
- Объединенным ячейкам
- Нестандартным форматам
- Пустым строкам и столбцам
- Различным вариантам записи данных

### Производительность
- Асинхронная архитектура для обработки множества запросов
- Индексы в базе данных для быстрых запросов
- Connection pooling через aiosqlite
- Оптимизированные SQL запросы

### Уведомления
- Утренние напоминания настраиваются индивидуально для каждого пользователя
- Уведомления об изменениях отправляются автоматически при обновлении расписания
- Все типы уведомлений можно отключить в настройках

## Разработка

### Запуск в режиме разработки
```bash
python main.py
```

### Логирование
Бот использует стандартный модуль `logging` Python. Логи выводятся в консоль с информацией о:
- Инициализации компонентов
- Парсинге файлов
- Отправке уведомлений
- Ошибках и исключениях

## Лицензия

MIT

## Автор

dianputriayu23