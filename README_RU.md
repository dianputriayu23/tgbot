# Telegram-бот для просмотра расписания колледжа

Полнофункциональный Telegram-бот для просмотра расписания занятий Пермского колледжа экономики и управления.

## Возможности

### Парсер расписания
- Парсинг XLSX файлов с использованием calamine + fallback на ручной XML парсинг
- Автоматическая загрузка расписания с сайта https://pkeu.ru/raspisanie-zanyatiy
- Извлечение: групп, дней, пар, предметов, преподавателей, кабинетов, времени
- Поддержка структуры: база 9 классов (3 листа для 1-3 курсов), база 11 классов (2 листа для 1-2 курсов)
- Автоматическое распознавание групп: Б1, Д1, Ю1 - база 9; ТД-25, Ю-25 - база 11
- Хранение расписаний 8 дней с автоматическим удалением старых

### Функционал бота
- `/start` - выбор базы обучения (9 или 11 классов)
- Выбор курса и группы
- Главное меню с кнопками: "Сегодня", "Завтра", "Пн"-"Сб", "Помощь", "Настройки"
- Красивый вывод расписания с эмодзи, временем, преподавателем и кабинетом
- Настройки: смена группы, управление уведомлениями
- Профиль пользователя: ID, группа, курс, статус уведомлений

### Уведомления
- 7:30 - напоминание о парах для студентов 1 и 3 курса
- 10:00 - напоминание о парах для студентов 2 курса
- 20:00 - расписание на завтра
- Моментальное уведомление при изменении расписания
- Проверка новых расписаний каждые 20 минут

### База данных
- SQLite с таблицами: users, schedule, schedule_files
- Поддержка 1000+ пользователей
- Хранение настроек уведомлений каждого пользователя

## Установка

### 1. Клонирование репозитория
```bash
git clone https://github.com/dianputriayu23/tgbot.git
cd tgbot
```

### 2. Создание виртуального окружения
```bash
python -m venv venv
```

### 3. Активация виртуального окружения

**Windows:**
```bash
venv\Scripts\activate
```

**Linux/Mac:**
```bash
source venv/bin/activate
```

### 4. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 5. Настройка переменных окружения

Создайте файл `.env` в корне проекта:
```env
API_TOKEN=ваш_токен_бота
ADMIN_ID=ваш_telegram_id
```

Для получения токена:
1. Найдите @BotFather в Telegram
2. Отправьте команду `/newbot`
3. Следуйте инструкциям
4. Скопируйте полученный токен в `.env`

### 6. Создание необходимых директорий
```bash
mkdir downloads data
```

## Запуск

### Обычный запуск
```bash
python main.py
```

### Запуск в фоновом режиме (Linux)
```bash
nohup python main.py &
```

### Остановка бота
Нажмите `Ctrl+C` или завершите процесс

## Структура проекта

```
tgbot/
├── database/           # Модуль работы с базой данных
│   ├── __init__.py
│   └── db.py          # Класс Database для SQLite
├── handlers/          # Обработчики команд
│   ├── __init__.py
│   ├── common.py      # /start, настройки, помощь
│   └── schedule_viewer.py  # Просмотр расписания
├── keyboards/         # Клавиатуры для бота
│   ├── __init__.py
│   ├── inline.py      # Inline-кнопки
│   └── reply.py       # Reply-кнопки
├── parser/            # Парсер расписания
│   ├── __init__.py
│   └── parser.py      # Загрузка и парсинг XLSX
├── scheduler/         # Планировщик задач
│   ├── __init__.py
│   └── jobs.py        # Автоматические задачи
├── utils/             # Вспомогательные модули
│   ├── __init__.py
│   └── states.py      # FSM состояния
├── downloads/         # Скачанные XLSX файлы
├── data/             # Служебные файлы
├── .env              # Переменные окружения (не в git)
├── .gitignore        # Исключения для git
├── main.py           # Точка входа
├── requirements.txt  # Зависимости Python
└── README_RU.md      # Документация
```

## Требования

- Python 3.8+
- Интернет-соединение для работы с Telegram API
- ~100MB свободного места на диске

## Зависимости

- aiogram 3.10.0 - фреймворк для Telegram Bot API
- aiohttp 3.9.5 - асинхронный HTTP-клиент
- beautifulsoup4 4.12.3 - парсинг HTML
- lxml 5.2.2 - XML/HTML парсер
- apscheduler 3.10.4 - планировщик задач
- python-dotenv 1.0.1 - работа с .env файлами
- aiosqlite 0.20.0 - асинхронная работа с SQLite
- python-calamine 0.5.4 - парсинг XLSX файлов

## Поддержка

При возникновении проблем:
1. Проверьте правильность токена в `.env`
2. Убедитесь, что все зависимости установлены
3. Проверьте логи бота в консоли
4. Создайте Issue в репозитории

## Автор

Проект создан для Пермского колледжа экономики и управления.

## Лицензия

MIT License
