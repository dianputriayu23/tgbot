#!/bin/bash

echo "================================================"
echo "     TELEGRAM БОТ РАСПИСАНИЯ PKEU"
echo "================================================"
echo ""

cd "$(dirname "$0")"

if [ ! -d "venv" ]; then
    echo "[1/3] Создание виртуального окружения..."
    python3 -m venv venv
    if [ $? -ne 0 ]; then
        echo "ОШИБКА: Не удалось создать виртуальное окружение"
        echo "Убедитесь, что Python 3.8+ установлен"
        exit 1
    fi
fi

echo "[2/3] Активация виртуального окружения..."
source venv/bin/activate
if [ $? -ne 0 ]; then
    echo "ОШИБКА: Не удалось активировать виртуальное окружение"
    exit 1
fi

if [ ! -f "venv/bin/aiogram" ]; then
    echo "[3/3] Установка зависимостей (первый запуск)..."
    pip install -r requirements.txt
    if [ $? -ne 0 ]; then
        echo "ОШИБКА: Не удалось установить зависимости"
        exit 1
    fi
fi

if [ ! -f ".env" ]; then
    echo ""
    echo "================================================"
    echo "ВНИМАНИЕ: Файл .env не найден!"
    echo "================================================"
    echo ""
    echo "Пожалуйста:"
    echo "1. Скопируйте файл .env.example в .env"
    echo "2. Откройте .env и укажите ваш токен бота"
    echo "3. Запустите скрипт снова"
    echo ""
    exit 1
fi

echo ""
echo "[✓] Запуск бота..."
echo "================================================"
echo "Для остановки нажмите Ctrl+C"
echo "================================================"
echo ""

python3 main.py

if [ $? -ne 0 ]; then
    echo ""
    echo "================================================"
    echo "ОШИБКА: Бот остановлен с ошибкой"
    echo "================================================"
    echo ""
fi
